<html>
  <head>
    <title><%= make_title %></title>

     <% def class_name(lang)
          lang.name.gsub(/\+/, 'p').gsub(/#/, 'sharp').gsub(/ /, '-')
        end
        
        others = summary.tallies[3..-1].select { |o| o.lines >= 1000 }
        unless others.empty?
          other_proficient = merge_langs(others.map(&:language))
        end %>

    <style>
      body {
        font-family: sans-serif;
        margin: 0;
        padding: 10px;
        background-color: #f0f0f0;
        color: #333;
      }

      table, th, td {
        border-collapse: collapse;
      }

      th, td {
        padding: 5px;
        border: 1px solid #333;
      }

      td.numeric {
        text-align: right;
      }

      <% summary.tallies.each do |t| %>
        <%= ".#{class_name(t.lang_obj)}" %> { 
          background-color: <%= t.lang_obj.color %>;
        } 
      <% end %>

      .pie {
        width: 250px;
        height: 250px;
        border-radius: 50%;
        border: 1px solid black;
        background-image: conic-gradient(
          <% counter = 0 %>
          <% summary.otherize.each_with_index do |t, i| %>
            <% color = t.language == 'Other' ? "#dddddd" : t.lang_obj.color %>
            <%= color %> <%= counter %>%,
            <% counter += byte_share(t.bytes) %>
            <%= color %> <%= counter %>%
            <% if i < summary.otherize.length - 1 %>,<% end %>
          <% end %>
        );
      }
    </style>
  </head>

<body>

<p><%= main_msg %></p>
<p><%= maj %></p>

<% unless others.empty? %>
<p>This <%= noun %> is also proficient in <%= other_proficient %>.</p>
<% end %>

<table>
  <tr>
    <th colspan="2">Language</th>
    <th>Bytes</th>
    <th>Share</th>
    <th>Files</th>
    <th>Lines</th>
    <th>LOC</th>
  </tr>
  <% summary.tallies.each do |t| %>
    <tr>
      <td class="<%= class_name(t.lang_obj) %>"></td>
      <td><%= t.language %></td>
      <td class="numeric"><%= format_bytes(t.bytes) %></td>
      <td class="numeric"><%= byte_share(t.bytes) %></td>
      <td class="numeric"><%= t.filecount %></td>
      <td class="numeric"><%= t.lines %></td>
      <td class="numeric"><%= t.loc %></td>
    </tr>
  <% end %>
</table>

<br/>

<div class="pie"></div>

</body>
</html>